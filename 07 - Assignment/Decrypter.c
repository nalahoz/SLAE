#include <stdio.h>
#include <string.h>
#include <stdint.h>

#define CBC 1
#define CTR 1
#define ECB 1

#include "aes.h"
int i;
static void decrypt(void)
{


    //KEY: aeskey00aeskey00aeskey00aeskey00
    uint8_t key[] = { 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30, 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30,
                      0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30, 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30 };

    // IV: aeskey00aeskey00
    uint8_t iv[]  = { 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30, 0x61, 0x65, 0x73, 0x6b, 0x65, 0x79, 0x30, 0x30 };

    //Shellcode "execve-stack" + 2 NOPs
    uint8_t shellcode[] = { 0x18, 0xd1, 0x38, 0x45, 0x48, 0x47, 0xd0, 0xff,
			    0x9b, 0xa6, 0xa6, 0x98, 0x20, 0x30, 0xed, 0x07,
			    0x66, 0x30, 0x79, 0x3b, 0x96, 0xed, 0x1e, 0x18,
			    0x27, 0x5b, 0xd1, 0x34, 0x69, 0xe2, 0x67, 0x50};
    struct AES_ctx ctx;

    AES_init_ctx_iv(&ctx, key, iv);
    AES_CBC_decrypt_buffer(&ctx, shellcode, sizeof(shellcode));

    printf("Decrypted Shellcode:");
    printf("\n");

    for (i = 0; i < sizeof shellcode; i ++)
    {
        printf("\\x%02x", shellcode[i]);
    }

    printf("\n");

}

int main(void)
{
    decrypt();
}
